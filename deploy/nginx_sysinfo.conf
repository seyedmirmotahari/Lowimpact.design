# NGINX snippet: proxy /sysinfo to a Raspberry Pi
#
# Place this inside the `server {}` block for `lowimpactdesign.me` (or include
# it from your domain's site config). Replace `PI_IP` with your Pi's LAN IP.

# Example: in /etc/nginx/sites-available/lowimpactdesign
location = /sysinfo {
    # Forward to Pi's local server
    proxy_pass http://PI_IP:8000/sysinfo;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # Keep connections fast and avoid buffering JSON responses
    proxy_connect_timeout 2s;
    proxy_read_timeout 5s;
    proxy_send_timeout 5s;
    proxy_buffering off;

    # Do not cache the sysinfo response
    add_header Cache-Control "no-store";

    # SECURITY: If your Pi is only accessible from the private LAN and you
    # want the proxy to be the only public entry point, leave as-is. To
    # restrict access to just your LAN (if nginx is on the Pi), uncomment:
    # allow 192.168.1.0/24;
    # deny all;
}
